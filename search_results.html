<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <header>
        <h1>Search Results</h1>
    </header>

    <main id="search-results-list">
        <!-- Search results will be loaded here dynamically -->
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const resultsContainer = document.getElementById("search-results-list");

            // Get the search query from the URL and decode it
            const queryString = new URLSearchParams(window.location.search).get("query");

            if (queryString) {
                // JSON files to load (adjust this if you need to load more APK files)
                const apkFiles = ["content/app1.json", "content/app2.json", "content/app3.json"]; // Update with all your APK files
                
                // Filter the APKs based on the search query
                const filteredResults = [];

                apkFiles.forEach(file => {
                    fetch(file)
                        .then(response => response.json())
                        .then(data => {
                            // Check if the title or short description matches the search query
                            if (data.title.toLowerCase().includes(queryString.toLowerCase()) || 
                                data.shortDescription.toLowerCase().includes(queryString.toLowerCase())) {
                                filteredResults.push(data);
                            }

                            // If all files are processed, display the results
                            if (filteredResults.length === apkFiles.length) {
                                displayResults(filteredResults);
                            }
                        })
                        .catch(error => console.error("Error loading APK:", error));
                });

                function displayResults(results) {
                    if (results.length > 0) {
                        results.forEach(apk => {
                            const apkItem = document.createElement("div");
                            apkItem.classList.add("apk-container");
                            apkItem.innerHTML = `
                                <img src="${apk.image}" alt="${apk.title}">
                                <div class="apk-info">
                                    <h2>${apk.title}</h2>
                                    <p class="size">${apk.size}</p>
                                    <p class="rating">‚≠ê ${apk.rating}</p>
                                    <p class="short-description">${apk.shortDescription}</p>
                                </div>
                            `;
                            // Clicking on an APK opens the details page
                            apkItem.onclick = () => window.open(`details.html?apk=${encodeURIComponent(apk.title)}`, "_blank");
                            resultsContainer.appendChild(apkItem);
                        });
                    } else {
                        resultsContainer.innerHTML = "<p>No results found.</p>";
                    }
                }
            } else {
                resultsContainer.innerHTML = "<p>No search query provided.</p>";
            }
        });
    </script>

</body>
</html>
